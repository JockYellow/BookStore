

===== static\js\purchase_form.js =====
// static/js/purchase_form.js (å…¨æ–°å…§å®¹)

document.addEventListener('DOMContentLoaded', function() {
    // DOM å…ƒç´ 
    const form = document.getElementById('purchase-form');
    const supplierSelect = document.getElementById('supplier');
    const itemsContainer = document.getElementById('items-container');
    const addItemBtn = document.getElementById('add-item');
    const itemTemplate = document.getElementById('item-template');
    
    let allProducts = [];
    let itemCounter = 1;

    // åˆå§‹åŒ–
    const init = async () => {
        window.app.ui.showLoading('è¼‰å…¥é é¢è³‡æ–™...');
        try {
            await Promise.all([loadSuppliers(), loadProducts()]);
            // åˆå§‹æ™‚ï¼Œç‚ºç¬¬ä¸€å€‹å•†å“é¸é …å¡«å……å…§å®¹
            populateProductOptions(document.querySelector('.product-select'));
        } catch (error) {
            console.error('åˆå§‹åŒ–å¤±æ•—:', error);
            window.app.ui.showNotification('error', 'é é¢è³‡æ–™è¼‰å…¥å¤±æ•—');
        } finally {
            window.app.ui.hideLoading();
        }
    };

    // è¼‰å…¥ä¾›æ‡‰å•†
    const loadSuppliers = async () => {
        const response = await fetch('/api/suppliers');
        if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥ä¾›æ‡‰å•†');
        const suppliers = await response.json();
        suppliers.forEach(supplier => {
            const option = document.createElement('option');
            option.value = supplier.id;
            option.textContent = supplier.name;
            supplierSelect.appendChild(option);
        });
    };

    // è¼‰å…¥å•†å“
    const loadProducts = async () => {
        const response = await fetch('/api/products');
        if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥å•†å“');
        allProducts = await response.json();
    };
    
    // å¡«å……å•†å“ä¸‹æ‹‰é¸é …
    const populateProductOptions = (selectElement) => {
        allProducts.forEach(product => {
            const option = document.createElement('option');
            option.value = product.id;
            option.textContent = `${product.name} (å”®åƒ¹: $${product.sale_price})`;
            // å°‡æˆæœ¬åƒ¹å­˜åœ¨ data attribute ä¸­ï¼Œæ–¹ä¾¿è‡ªå‹•å¸¶å…¥
            option.dataset.cost = product.purchase_price || 0;
            selectElement.appendChild(option);
        });
    };
    
    // æ–°å¢ä¸€ç­†å•†å“é …ç›®
    const addNewItem = () => {
        const newItemFragment = itemTemplate.content.cloneNode(true);
        const newItemRow = newItemFragment.querySelector('.item-row');
        
        // æ›´æ–° name å±¬æ€§ä¸­çš„ç´¢å¼•ï¼Œç¢ºä¿å¾Œç«¯èƒ½æ­£ç¢ºè§£æ
        newItemRow.querySelectorAll('[name]').forEach(input => {
            input.name = input.name.replace(/\[\d+\]/, `[${itemCounter}]`);
        });
        itemCounter++;

        populateProductOptions(newItemRow.querySelector('.product-select'));
        itemsContainer.appendChild(newItemRow);
    };

    // è¨ˆç®—ç¸½é‡‘é¡
    const calculateTotals = () => {
        let subtotal = 0;
        itemsContainer.querySelectorAll('.item-row').forEach(row => {
            const quantity = parseFloat(row.querySelector('.quantity-input').value) || 0;
            const price = parseFloat(row.querySelector('.price-input').value) || 0;
            subtotal += quantity * price;
        });

        const shippingFee = parseFloat(document.getElementById('shipping-fee').value) || 0;
        const taxRate = (parseFloat(document.getElementById('tax-rate').value) || 0) / 100;
        const tax = subtotal * taxRate;
        const total = subtotal + shippingFee + tax;

        document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
        document.getElementById('shipping-total').textContent = `$${shippingFee.toFixed(2)}`;
        document.getElementById('tax-amount').textContent = `$${tax.toFixed(2)}`;
        document.getElementById('total-amount').textContent = `$${total.toFixed(2)}`;
    };

    // è™•ç†è¡¨å–®æäº¤
    const handleFormSubmit = async (e) => {
        e.preventDefault();
        
        const items = [];
        document.querySelectorAll('.item-row').forEach(row => {
            const productId = row.querySelector('.product-select').value;
            if (productId) {
                items.push({
                    product_id: productId,
                    quantity: parseInt(row.querySelector('.quantity-input').value, 10),
                    unit_price: parseFloat(row.querySelector('.price-input').value)
                });
            }
        });

        if (!supplierSelect.value) {
            window.app.ui.showNotification('error', 'è«‹é¸æ“‡ä¸€å€‹ä¾›æ‡‰å•†');
            return;
        }
        if (items.length === 0) {
            window.app.ui.showNotification('error', 'è«‹è‡³å°‘æ–°å¢ä¸€é …å•†å“');
            return;
        }

        const purchaseData = {
            supplier_id: supplierSelect.value,
            purchase_date: document.getElementById('purchase-date').value,
            expected_delivery_date: document.getElementById('expected-delivery-date').value,
            shipping_cost: parseFloat(document.getElementById('shipping-fee').value) || 0,
            tax_rate: parseFloat(document.getElementById('tax-rate').value) || 0,
            payment_status: document.getElementById('payment-status').value,
            notes: document.getElementById('notes').value,
            status: 'ordered', // æˆ–æ ¹æ“šéœ€æ±‚è¨­å®š
            items: items
        };

        window.app.ui.showLoading('æ­£åœ¨å„²å­˜é€²è²¨å–®...');
        try {
            const response = await fetch('/api/purchases', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(purchaseData)
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.detail || 'å„²å­˜å¤±æ•—');
            }
            
            window.app.ui.showNotification('success', 'é€²è²¨å–®å·²æˆåŠŸå»ºç«‹ï¼');
            // å»¶é²1.5ç§’å¾Œè·³è½‰å›åˆ—è¡¨é 
            setTimeout(() => {
                window.location.href = '/purchases';
            }, 1500);

        } catch (error) {
            console.error('å„²å­˜å¤±æ•—:', error);
            window.app.ui.showNotification('error', error.message);
        } finally {
            window.app.ui.hideLoading();
        }
    };
    
    // è¨­å®šäº‹ä»¶ç›£è½
    addItemBtn.addEventListener('click', addNewItem);
    form.addEventListener('submit', handleFormSubmit);

    // å‹•æ…‹ç¶å®šäº‹ä»¶
    itemsContainer.addEventListener('click', (e) => {
        if (e.target.closest('.remove-item')) {
            if (itemsContainer.querySelectorAll('.item-row').length > 1) {
                e.target.closest('.item-row').remove();
                calculateTotals();
            } else {
                window.app.ui.showNotification('warning', 'è‡³å°‘éœ€è¦ä¸€é …å•†å“');
            }
        }
    });

    itemsContainer.addEventListener('change', (e) => {
        if (e.target.classList.contains('product-select')) {
            const selectedOption = e.target.options[e.target.selectedIndex];
            const cost = selectedOption.dataset.cost || '0';
            e.target.closest('.item-row').querySelector('.price-input').value = cost;
        }
        calculateTotals();
    });

    form.addEventListener('input', (e) => {
        if (e.target.matches('#shipping-fee, #tax-rate')) {
            calculateTotals();
        }
    });

    // åˆå§‹åŒ–
    init();
});

===== static\js\reports.js =====
document.addEventListener('DOMContentLoaded', () => {
    const topProductsBody = document.getElementById('topProductsBody');

    const loadReport = async () => {
        window.app.ui.showLoading('è¼‰å…¥å ±è¡¨è³‡æ–™...');
        try {
            const res = await fetch('/api/reports/overview');
            if (!res.ok) throw new Error('load failed');
            const data = await res.json();
            renderCharts(data);
            renderTopProducts(data.top_products);
        } catch (err) {
            console.error(err);
            window.app.ui.showNotification('error', 'è¼‰å…¥å ±è¡¨å¤±æ•—');
        } finally {
            window.app.ui.hideLoading();
        }
    };

    const renderCharts = (data) => {
        const dailyLabels = Object.keys(data.daily_sales || {});
        const dailyValues = Object.values(data.daily_sales || {});
        const ctxDaily = document.getElementById('dailySalesChart').getContext('2d');
        new Chart(ctxDaily, {
            type: 'line',
            data: {
                labels: dailyLabels,
                datasets: [{
                    label: 'éŠ·å”®é¡',
                    data: dailyValues,
                    backgroundColor: 'rgba(59,130,246,0.1)',
                    borderColor: 'rgb(59,130,246)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true } }
            }
        });

        const categoryLabels = Object.keys(data.category_sales || {});
        const categoryValues = Object.values(data.category_sales || {});
        const ctxCategory = document.getElementById('categorySalesChart').getContext('2d');
        new Chart(ctxCategory, {
            type: 'doughnut',
            data: {
                labels: categoryLabels,
                datasets: [{
                    data: categoryValues,
                    backgroundColor: [
                        '#60a5fa','#34d399','#fbbf24','#f87171','#a78bfa','#f472b6'
                    ]
                }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });
    };

    const renderTopProducts = (products) => {
        if (!products || products.length === 0) {
            topProductsBody.innerHTML = '<tr><td colspan="2" class="text-center py-4">ç„¡è³‡æ–™</td></tr>';
            return;
        }
        topProductsBody.innerHTML = products.map(p => `
            <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${p.name}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$${p.amount}</td>
            </tr>
        `).join('');
    };

    loadReport();
});


===== static\js\sales.js =====
// static/js/sales.js (ä¿®æ”¹å¾Œï¼Œæ”¯æ´æœƒå“¡æŠ˜æ‰£èˆ‡æ‰¾é›¶)

document.addEventListener('DOMContentLoaded', function() {
    // DOM å…ƒç´ 
    const productGrid = document.getElementById('product-grid');
    const cartItems = document.getElementById('cart-items');
    const cartCount = document.getElementById('cart-count');
    const subtotalElement = document.getElementById('subtotal');
    const totalAmount = document.getElementById('total-amount');
    const discountAmount = document.getElementById('discount-amount');
    const checkoutBtn = document.getElementById('checkout-btn');
    const checkoutModal = document.getElementById('checkout-modal');
    const productSearch = document.getElementById('product-search');
    const categoryFilter = document.getElementById('category-filter');
    const memberSelect = document.getElementById('member-select');
    const memberInfo = document.getElementById('member-info');
    const newSaleBtn = document.getElementById('new-sale-btn');

    // æœƒå“¡ç›¸é—œå…ƒç´ èˆ‡æ‰¾é›¶
    const memberList = document.getElementById('member-list');
    const memberModal = document.getElementById('member-modal');
    const memberSearch = document.getElementById('member-search');
    const nonMemberBtn = document.getElementById('non-member-btn');
    const amountReceivedInput = document.getElementById('amount-received');
    const changeDisplay = document.getElementById('change-display');
    const calcChangeBtn = document.getElementById('calc-change-btn');
    const memberDiscountDisplay = document.getElementById('member-discount');
    const discountType = document.getElementById('discount-type');
    const discountValue = document.getElementById('discount-value');
    const manualDiscountDisplay = document.getElementById('manual-discount');

    // å…¨åŸŸè®Šæ•¸
    let allProducts = [];
    let cart = []; // è³¼ç‰©è»Šçµæ§‹: [{ id, name, price, quantity }, ...]
    let members = [];
    let selectedMember = null;

    // åˆå§‹åŒ–
    const init = async () => {
        window.app.ui.showLoading('è¼‰å…¥å•†å“è³‡æ–™...');
        try {
            await loadProducts();
            await loadMembers();
            populateCategories();
            renderProductGrid(allProducts);
            setupEventListeners();
            updateCartUI();
        } catch (error) {
            console.error('åˆå§‹åŒ–å¤±æ•—:', error);
            window.app.ui.showNotification('error', 'é é¢è¼‰å…¥å¤±æ•—');
        } finally {
            window.app.ui.hideLoading();
        }
    };

    // è¼‰å…¥å•†å“
    const loadProducts = async () => {
        const response = await fetch('/api/products');
        if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥å•†å“');
        allProducts = await response.json();
    };

    const populateCategories = () => {
        if (!categoryFilter) return;
        const cats = Array.from(new Set(allProducts.map(p => p.category).filter(Boolean)));
        categoryFilter.innerHTML = '<option value="">æ‰€æœ‰åˆ†é¡</option>' +
            cats.map(c => `<option value="${c}">${c}</option>`).join('');
    };

    // è¼‰å…¥æœƒå“¡è³‡æ–™
    const renderMemberList = (list) => {
        if (!memberList) return;
        memberList.innerHTML = list.map(m => `
            <li class="py-3 px-2 hover:bg-gray-50 cursor-pointer" data-id="${m.id}">
                <div class="flex items-center">
                    <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                        <span class="text-blue-600 font-medium">${(m.name || m.id).charAt(0)}</span>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-900">${m.name || m.id}</p>
                        <p class="text-sm text-gray-500">${m.phone || ''}</p>
                    </div>
                    <div class="ml-auto text-sm text-gray-500">
                        ç´¯ç© ${(m.total_spent || 0).toLocaleString()} å…ƒ
                    </div>
                </div>
            </li>
        `).join('');
    };

    const loadMembers = async () => {
        try {
            const response = await fetch('/api/members');
            if (response.ok) {
                const data = await response.json();
                members = Array.isArray(data) ? data : (data.data || []);
                if (memberSelect) {
                    memberSelect.innerHTML = '<option value="">éæœƒå“¡é¡§å®¢</option>' +
                        members.map(m => `<option value="${m.id}">${m.name || m.id}</option>`).join('');
                }
                renderMemberList(members);
            }
        } catch (error) {
            console.warn('è¼‰å…¥æœƒå“¡è³‡æ–™å¤±æ•—:', error);
        }
    };

    // æ¸²æŸ“å•†å“åˆ—è¡¨
    const renderProductGrid = (products) => {
        if (products.length === 0) {
            productGrid.innerHTML = `<div class="text-center py-4">ç›®å‰æ²’æœ‰å•†å“</div>`;
            return;
        }
        productGrid.innerHTML = products.map(p => `
            <div class="product-item" data-id="${p.id}">
                <div class="font-medium">${p.name}</div>
                <div class="text-sm text-gray-500">$${p.sale_price}</div>
                <div class="text-xs text-gray-400">åº«å­˜: ${p.stock}</div>
            </div>
        `).join('');
    };

    // æ–°å¢è‡³è³¼ç‰©è»Š
    const addToCart = (productId) => {
        const product = allProducts.find(p => p.id === productId);
        if (!product) return;

        const existingItem = cart.find(item => item.id === productId);
        if (existingItem) {
            existingItem.quantity++;
        } else {
            cart.push({
                id: product.id,
                name: product.name,
                price: product.sale_price,
                quantity: 1,
            });
        }
        updateCartUI();
    };

    // æ›´æ–°è³¼ç‰©è»Š UI
    const updateCartUI = () => {
        if (cart.length === 0) {
            cartItems.innerHTML = `
                <div class="p-4 text-center text-gray-500">è³¼ç‰©è»Šæ˜¯ç©ºçš„</div>
            `;
        } else {
            cartItems.innerHTML = cart.map(item => `
                <div class="cart-item flex justify-between items-center" data-id="${item.id}">
                    <div>
                        <div>${item.name}</div>
                        <div class="text-sm text-gray-400">$${item.price} x ${item.quantity}</div>
                    </div>
                    <div class="font-medium">$${(item.price * item.quantity).toLocaleString()}</div>
                    <button class="remove-item text-red-500">x</button>
                </div>
            `).join('');
        }

        const subtotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
        let discount = 0;
        if (selectedMember && selectedMember.discount_rate) {
            discount = subtotal * selectedMember.discount_rate;
        }
        const total = subtotal - discount;

        subtotalElement.textContent = `$${subtotal.toLocaleString()}`;
        totalAmount.textContent = `$${total.toLocaleString()}`;
        if (discountAmount) {
            discountAmount.textContent = `-$${discount.toLocaleString()}`;
        }
        if (memberDiscountDisplay) {
            memberDiscountDisplay.textContent = `-$${discount.toLocaleString()}`;
        }
        if (memberInfo) {
            if (selectedMember) {
                memberInfo.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                            <i class="fas fa-user text-blue-500"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">${selectedMember.name || selectedMember.id}</p>
                            <p class="text-xs text-gray-500">${selectedMember.phone || ''}</p>
                        </div>
                    </div>`;
            } else {
                memberInfo.innerHTML = `
                    <div class="flex items-center">
                        <div class="flex-shrink-0 h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-user text-gray-400"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-gray-900">éæœƒå“¡é¡§å®¢</p>
                            <p class="text-xs text-gray-500">ç„¡æœƒå“¡æŠ˜æ‰£</p>
                        </div>
                    </div>`;
            }
        }
        cartCount.textContent = `${cart.length} é …å•†å“`;
        checkoutBtn.disabled = cart.length === 0;
    };

    const filterProducts = () => {
        let filtered = [...allProducts];
        const search = productSearch ? productSearch.value.trim().toLowerCase() : '';
        const category = categoryFilter ? categoryFilter.value : '';
        if (search) {
            filtered = filtered.filter(p =>
                p.name.toLowerCase().includes(search) ||
                (p.id && p.id.toLowerCase().includes(search))
            );
        }
        if (category) {
            filtered = filtered.filter(p => p.category === category);
        }
        renderProductGrid(filtered);
    };

    // è™•ç†çµå¸³æµç¨‹
    const processCheckout = async () => {
        const subtotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
        let memberDiscount = 0;
        if (selectedMember && selectedMember.discount_rate) {
            memberDiscount = subtotal * selectedMember.discount_rate;
        }
        let manualDiscount = 0;
        const discType = discountType ? discountType.value : '';
        const discVal = discountValue ? parseFloat(discountValue.value) || 0 : 0;
        if (discType === 'percentage') {
            manualDiscount = subtotal * (discVal / 100);
        } else if (discType === 'amount') {
            manualDiscount = discVal;
        }
        const total = subtotal - memberDiscount - manualDiscount;

        const received = amountReceivedInput && amountReceivedInput.value ? parseFloat(amountReceivedInput.value) : total;
        const change = received - total;

        const saleData = {
            items: cart.map(item => ({
                product_id: item.id,
                quantity: item.quantity,
                unit_price: item.price
            })),
            total: total,
            subtotal: subtotal,
            discount: memberDiscount + manualDiscount,
            manual_discount_type: discType || null,
            manual_discount_value: discVal,
            amount_received: received,
            change: change,
            member_id: selectedMember ? selectedMember.id : null
        };

        window.app.ui.showLoading('çµå¸³ä¸­...');
        try {
            const response = await fetch('/api/sales', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(saleData)
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.detail || 'çµå¸³å¤±æ•—');
            }
            window.app.ui.showNotification('success', 'çµå¸³æˆåŠŸï¼');
            await loadProducts();
            populateCategories();
            filterProducts();
            cart = []; // æ¸…ç©ºè³¼ç‰©è»Š
            selectedMember = null;
            if (discountType) discountType.value = '';
            if (discountValue) discountValue.value = 0;
            updateCartUI();
            checkoutModal.classList.add('hidden'); // é—œé–‰çµå¸³è¦–çª—
            document.body.classList.remove('overflow-hidden');
        } catch (error) {
            console.error('çµå¸³å¤±æ•—:', error);
            window.app.ui.showNotification('error', error.message);
        } finally {
            window.app.ui.hideLoading();
        }
    };

    // è¨­å®šäº‹ä»¶ç›£è½å™¨
    const setupEventListeners = () => {
        productGrid.addEventListener('click', (e) => {
            const item = e.target.closest('.product-item');
            if (item) {
                addToCart(item.dataset.id);
            }
        });

        if (productSearch) {
            productSearch.addEventListener('input', filterProducts);
        }
        if (categoryFilter) {
            categoryFilter.addEventListener('change', filterProducts);
        }
        if (memberSelect) {
            memberSelect.addEventListener('change', () => {
                const val = memberSelect.value;
                selectedMember = members.find(m => m.id === val) || null;
                updateCartUI();
            });
        }
        if (memberList) {
            memberList.addEventListener('click', (e) => {
                const li = e.target.closest('li[data-id]');
                if (li) {
                    const id = li.dataset.id;
                    selectedMember = members.find(m => m.id === id) || null;
                    if (memberSelect) memberSelect.value = id;
                    updateCartUI();
                    if (memberModal) {
                        memberModal.classList.add('hidden');
                        document.body.classList.remove('overflow-hidden');
                    }
                }
            });
        }
        if (memberSearch) {
            memberSearch.addEventListener('input', () => {
                const term = memberSearch.value.trim().toLowerCase();
                const filtered = members.filter(m =>
                    (m.name || '').toLowerCase().includes(term) ||
                    (m.phone || '').toLowerCase().includes(term)
                );
                renderMemberList(filtered);
            });
        }
        document.querySelectorAll('.close-member-modal-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (memberModal) {
                    memberModal.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                }
            });
        });
        if (nonMemberBtn) {
            nonMemberBtn.addEventListener('click', () => {
                selectedMember = null;
                if (memberSelect) memberSelect.value = '';
                updateCartUI();
                if (memberModal) {
                    memberModal.classList.add('hidden');
                    document.body.classList.remove('overflow-hidden');
                }
            });
        }
        if (newSaleBtn) {
            newSaleBtn.addEventListener('click', () => {
                cart = [];
                selectedMember = null;
                if (memberSelect) memberSelect.value = '';
                updateCartUI();
            });
        }

        cartItems.addEventListener('click', (e) => {
            const removeBtn = e.target.closest('.remove-item');
            if (removeBtn) {
                const itemId = removeBtn.closest('[data-id]').dataset.id;
                cart = cart.filter(item => item.id !== itemId);
                updateCartUI();
            }
        });

        checkoutBtn.addEventListener('click', async () => {
            // å¡«å……çµå¸³ Modal
            const subtotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
            let discount = 0;
            if (selectedMember && selectedMember.discount_rate) {
                discount = subtotal * selectedMember.discount_rate;
            }
            document.getElementById('checkout-subtotal').textContent = `$${subtotal.toLocaleString()}`;
            memberDiscountDisplay.textContent = `-$${discount.toLocaleString()}`;
            if (manualDiscountDisplay) manualDiscountDisplay.textContent = '-$0';
            if (discountType) discountType.value = '';
            if (discountValue) discountValue.value = 0;
            document.getElementById('checkout-total').textContent = `$${(subtotal - discount).toLocaleString()}`;
            const checkoutItems = document.getElementById('checkout-items');
            checkoutItems.innerHTML = cart.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td>$${item.price}</td>
                    <td>${item.quantity}</td>
                    <td>$${(item.price * item.quantity).toLocaleString()}</td>
                </tr>
            `).join('');
            updateCheckoutSummary();
            checkoutModal.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
        });

        // çµå¸³ Modal å…§çš„æŒ‰éˆ•
        document.getElementById('confirm-checkout-btn').addEventListener('click', processCheckout);
        document.querySelectorAll('.close-checkout-modal-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                checkoutModal.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            });
        });

        const calculateChange = () => {
            const totalText = document.getElementById('checkout-total')?.textContent || '0';
            const total = parseFloat(totalText.replace(/[$,]/g, '')) || 0;
            const received = parseFloat(amountReceivedInput.value);
            if (!isNaN(received) && received >= total) {
                const changeVal = received - total;
                changeDisplay.value = changeVal.toLocaleString();
            } else {
                changeDisplay.value = '0';
            }
        };

        const updateCheckoutSummary = () => {
            const subtotal = cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
            let discount = 0;
            if (selectedMember && selectedMember.discount_rate) {
                discount = subtotal * selectedMember.discount_rate;
            }
            let manual = 0;
            const dt = discountType ? discountType.value : '';
            const dv = discountValue ? parseFloat(discountValue.value) || 0 : 0;
            if (dt === 'percentage') manual = subtotal * (dv / 100);
            else if (dt === 'amount') manual = dv;
            const total = subtotal - discount - manual;
            document.getElementById('checkout-subtotal').textContent = `$${subtotal.toLocaleString()}`;
            memberDiscountDisplay.textContent = `-$${discount.toLocaleString()}`;
            manualDiscountDisplay.textContent = `-$${manual.toLocaleString()}`;
            document.getElementById('checkout-total').textContent = `$${total.toLocaleString()}`;
            calculateChange();
        };

        if (discountType) {
            discountType.addEventListener('change', updateCheckoutSummary);
        }
        if (discountValue) {
            discountValue.addEventListener('input', updateCheckoutSummary);
        }

        // è¨ˆç®—æ‰¾é›¶
        if (calcChangeBtn && amountReceivedInput && changeDisplay) {
            calcChangeBtn.addEventListener('click', calculateChange);
            amountReceivedInput.addEventListener('input', calculateChange);
        }
    };

    // åˆå§‹è¼‰å…¥
    init();
});


===== static\js\sales_history.js =====
// static/js/sales_history.js

document.addEventListener('DOMContentLoaded', function() {
    const historyList = document.getElementById('sales-history-list');

    const renderSales = (sales) => {
        if (!historyList) return;
        if (!sales || sales.length === 0) {
            historyList.innerHTML = `<tr><td colspan="4" class="text-center py-4">æ²’æœ‰ä»»ä½•éŠ·å”®è¨˜éŒ„</td></tr>`;
            return;
        }
        historyList.innerHTML = sales.map(sale => {
            const amount = sale.total || sale.final_amount || 0;
            const date = sale.created_at || sale.sale_date;
            return `
                <tr data-id="${sale.id}" class="cursor-pointer hover:bg-gray-100">
                    <td class="px-6 py-4 whitespace-nowrap">${sale.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${sale.member_id || '-'}</td>
                    <td class="px-6 py-4 whitespace-nowrap">$${amount.toLocaleString()}</td>
                    <td class="px-6 py-4 whitespace-nowrap">${date ? new Date(date).toLocaleString() : ''}</td>
                </tr>
            `;
        }).join('');
    };

    const loadSales = async () => {
        try {
            const res = await fetch('/api/sales');
            if (!res.ok) throw new Error('load failed');
            const data = await res.json();
            renderSales(data);
        } catch (err) {
            console.error(err);
            historyList.innerHTML = `<tr><td colspan="4" class="text-center py-4 text-red-500">è¼‰å…¥å¤±æ•—</td></tr>`;
        }
    };

    loadSales();

    const modal = document.getElementById('sale-detail-modal');
    const content = document.getElementById('sale-detail-content');
    const closeBtns = [document.getElementById('close-sale-detail'), document.getElementById('sale-detail-close-btn')];

    const closeModal = () => {
        modal.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
    };

    closeBtns.forEach(btn => btn?.addEventListener('click', closeModal));

    historyList.addEventListener('click', async (e) => {
        const row = e.target.closest('tr[data-id]');
        if (!row) return;
        try {
            const res = await fetch(`/api/sales/${row.dataset.id}`);
            if (!res.ok) throw new Error('load failed');
            const sale = await res.json();
            const itemsHtml = (sale.items || []).map(it => `
                <tr>
                    <td class="px-2 py-1">${it.product_id}</td>
                    <td class="px-2 py-1 text-right">${it.quantity}</td>
                    <td class="px-2 py-1 text-right">$${it.unit_price}</td>
                    <td class="px-2 py-1 text-right">$${(it.quantity * it.unit_price).toLocaleString()}</td>
                </tr>
            `).join('');
            content.innerHTML = `
                <p class="mb-2">è¨‚å–®ç·¨è™Ÿï¼š${sale.id}</p>
                <p class="mb-2">æœƒå“¡ï¼š${sale.member_id || '-'}</p>
                <table class="min-w-full text-sm mb-2">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-2 py-1 text-left">å•†å“</th>
                            <th class="px-2 py-1 text-right">æ•¸é‡</th>
                            <th class="px-2 py-1 text-right">å–®åƒ¹</th>
                            <th class="px-2 py-1 text-right">å°è¨ˆ</th>
                        </tr>
                    </thead>
                    <tbody>${itemsHtml}</tbody>
                </table>
                <p class="text-right">å°è¨ˆï¼š$${(sale.subtotal || 0).toLocaleString()}</p>
                <p class="text-right">æŠ˜æ‰£ï¼š-$${(sale.discount || 0).toLocaleString()}</p>
                <p class="text-right font-bold">ç¸½è¨ˆï¼š$${(sale.total || 0).toLocaleString()}</p>
            `;
            modal.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
        } catch (err) {
            console.error(err);
        }
    });
});


===== static\js\suppliers.js =====
// static/js/suppliers.js (å…¨æ–°å…§å®¹)

document.addEventListener('DOMContentLoaded', function() {
    // DOM å…ƒç´ 
    const addSupplierBtn = document.getElementById('add-supplier-btn');
    const supplierModal = document.getElementById('supplier-modal');
    const modalTitle = document.getElementById('modal-title');
    const supplierForm = document.getElementById('supplier-form');
    const cancelSupplierBtn = document.getElementById('cancel-supplier');
    const suppliersList = document.getElementById('suppliers-list');

    let allSuppliers = [];

    // é–‹å•Ÿ Modal
    const openSupplierModal = (supplier = null) => {
        supplierForm.reset();
        supplierForm.dataset.id = '';

        if (supplier) {
            // ç·¨è¼¯æ¨¡å¼
            modalTitle.textContent = 'ç·¨è¼¯ä¾›æ‡‰å•†';
            supplierForm.dataset.id = supplier.id;
            document.getElementById('supplier-name').value = supplier.name || '';
            document.getElementById('contact-person').value = supplier.contact_person || '';
            document.getElementById('phone').value = supplier.phone || '';
            document.getElementById('email').value = supplier.email || '';
            document.getElementById('address').value = supplier.address || '';
            document.getElementById('payment-terms').value = supplier.payment_terms || '';
            document.getElementById('notes').value = supplier.notes || '';
        } else {
            // æ–°å¢æ¨¡å¼
            modalTitle.textContent = 'æ–°å¢ä¾›æ‡‰å•†';
        }
        
        supplierModal.classList.remove('hidden');
        document.body.classList.add('overflow-hidden');
    };

    // é—œé–‰ Modal
    const closeSupplierModal = () => {
        supplierModal.classList.add('hidden');
        document.body.classList.remove('overflow-hidden');
    };
    
    // è¼‰å…¥ä¾›æ‡‰å•†è³‡æ–™
    const loadSuppliers = async () => {
        window.app.ui.showLoading('è¼‰å…¥ä¾›æ‡‰å•†è³‡æ–™ä¸­...');
        try {
            const response = await fetch('/api/suppliers');
            if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥ä¾›æ‡‰å•†è³‡æ–™');
            allSuppliers = await response.json();
            renderSuppliers(allSuppliers);
        } catch (error) {
            console.error('è¼‰å…¥ä¾›æ‡‰å•†è³‡æ–™å¤±æ•—:', error);
            window.app.ui.showNotification('error', 'è¼‰å…¥ä¾›æ‡‰å•†è³‡æ–™å¤±æ•—');
        } finally {
            window.app.ui.hideLoading();
        }
    };

    // æ¸²æŸ“åˆ—è¡¨
    const renderSuppliers = (suppliers) => {
        if (!suppliersList) return;
        if (suppliers.length === 0) {
            suppliersList.innerHTML = `<tr><td colspan="6" class="text-center py-4">æ²’æœ‰ä¾›æ‡‰å•†è³‡æ–™</td></tr>`;
            return;
        }

        suppliersList.innerHTML = suppliers.map(supplier => `
            <tr data-id="${supplier.id}">
                <td class="px-6 py-4 whitespace-nowrap">${supplier.name}</td>
                <td class="px-6 py-4 whitespace-nowrap">${supplier.contact_person}</td>
                <td class="px-6 py-4 whitespace-nowrap">${supplier.phone}</td>
                <td class="px-6 py-4 whitespace-nowrap">${supplier.payment_terms}</td>
                <td class="px-6 py-4 whitespace-nowrap">${new Date(supplier.created_at).toLocaleDateString()}</td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <button class="text-blue-600 hover:text-blue-900 edit-supplier"><i class="fas fa-edit"></i> ç·¨è¼¯</button>
                    <button class="text-red-600 hover:text-red-900 ml-4 delete-supplier"><i class="fas fa-trash"></i> åˆªé™¤</button>
                </td>
            </tr>
        `).join('');
    };

    // è™•ç†è¡¨å–®æäº¤
    const handleSubmitSupplier = async (e) => {
        e.preventDefault();
        const supplierId = supplierForm.dataset.id;
        const isEdit = !!supplierId;
        
        const formData = new FormData(supplierForm);
        const supplierData = {
            name: formData.get('name').trim(),
            contact_person: formData.get('contact_person').trim(),
            phone: formData.get('phone').trim(),
            email: formData.get('email').trim(),
            address: formData.get('address').trim(),
            payment_terms: formData.get('payment_terms'),
            notes: formData.get('notes').trim(),
        };

        if (!supplierData.name || !supplierData.contact_person || !supplierData.phone) {
            window.app.ui.showNotification('error', 'è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ (*)');
            return;
        }

        const url = isEdit ? `/api/suppliers/${supplierId}` : '/api/suppliers';
        const method = isEdit ? 'PUT' : 'POST';

        window.app.ui.showLoading('å„²å­˜ä¸­...');
        try {
            const response = await fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(supplierData)
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.detail || 'å„²å­˜å¤±æ•—');
            }

            window.app.ui.showNotification('success', 'ä¾›æ‡‰å•†è³‡æ–™å„²å­˜æˆåŠŸï¼');
            closeSupplierModal();
            loadSuppliers();
        } catch (error) {
            console.error('å„²å­˜ä¾›æ‡‰å•†å¤±æ•—:', error);
            window.app.ui.showNotification('error', error.message);
        } finally {
            window.app.ui.hideLoading();
        }
    };
    
    // è™•ç†åˆ—è¡¨é»æ“Šäº‹ä»¶
    const handleListClick = (e) => {
        const target = e.target;
        const row = target.closest('tr');
        if (!row) return;

        const supplierId = row.dataset.id;
        const supplier = allSuppliers.find(s => s.id === supplierId);

        if (target.closest('.edit-supplier')) {
            if (supplier) openSupplierModal(supplier);
        }

        if (target.closest('.delete-supplier')) {
             window.app.ui.showConfirmDialog({
                title: 'ç¢ºèªåˆªé™¤',
                message: `æ‚¨ç¢ºå®šè¦åˆªé™¤ä¾›æ‡‰å•† "${supplier.name}" å—ï¼Ÿ`,
                confirmText: 'ç¢ºèªåˆªé™¤',
            }).then(confirmed => {
                if (confirmed) {
                    deleteSupplier(supplierId);
                }
            });
        }
    };

    // åˆªé™¤ä¾›æ‡‰å•†
    const deleteSupplier = async (supplierId) => {
        window.app.ui.showLoading('åˆªé™¤ä¸­...');
        try {
            const response = await fetch(`/api/suppliers/${supplierId}`, { method: 'DELETE' });
            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.detail || 'åˆªé™¤å¤±æ•—');
            }
            window.app.ui.showNotification('success', 'ä¾›æ‡‰å•†å·²åˆªé™¤');
            loadSuppliers();
        } catch (error) {
            console.error('åˆªé™¤ä¾›æ‡‰å•†å¤±æ•—:', error);
            window.app.ui.showNotification('error', error.message);
        } finally {
            window.app.ui.hideLoading();
        }
    };

    // è¨­å®šäº‹ä»¶ç›£è½
    addSupplierBtn.addEventListener('click', () => openSupplierModal());
    cancelSupplierBtn.addEventListener('click', closeSupplierModal);
    supplierForm.addEventListener('submit', handleSubmitSupplier);
    suppliersList.addEventListener('click', handleListClick);

    // åˆå§‹è¼‰å…¥
    loadSuppliers();
})


===== static\js\ui.js =====
// UI é€šç”¨åŠŸèƒ½
class UI {
    constructor() {
        this.initializeComponents();
        this.setupEventListeners();
    }

    // åˆå§‹åŒ–æ‰€æœ‰ UI çµ„ä»¶
    initializeComponents() {
        this.loadingElement = document.getElementById('loading');
        this.notificationsElement = document.getElementById('notifications');
        this.confirmDialog = document.getElementById('confirm-dialog');
        
        if (this.confirmDialog) {
            this.confirmTitle = document.getElementById('confirm-title');
            this.confirmMessage = document.getElementById('confirm-message');
            this.confirmOkBtn = document.getElementById('confirm-ok');
            this.confirmCancelBtn = document.getElementById('confirm-cancel');
        }
    }

    // è¨­ç½®äº‹ä»¶ç›£è½å™¨
    setupEventListeners() {
        // é—œé–‰é€šçŸ¥æŒ‰éˆ•
        document.addEventListener('click', (e) => {
            if (e.target.closest('.close-notification')) {
                this.hideNotification(e.target.closest('.notification'));
            }
        });

        // ç¢ºèªå°è©±æ¡†æŒ‰éˆ•
        if (this.confirmCancelBtn) {
            this.confirmCancelBtn.addEventListener('click', () => this.hideConfirmDialog());
        }
    }

    // é¡¯ç¤ºåŠ è¼‰æŒ‡ç¤ºå™¨
    showLoading(message = 'è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™...') {
        if (this.loadingElement) {
            const messageEl = this.loadingElement.querySelector('span');
            if (messageEl) messageEl.textContent = message;
            this.loadingElement.classList.remove('hidden');
        }
    }

    // éš±è—åŠ è¼‰æŒ‡ç¤ºå™¨
    hideLoading() {
        if (this.loadingElement) {
            this.loadingElement.classList.add('hidden');
        }
    }

    // é¡¯ç¤ºé€šçŸ¥
    showNotification(type, message, duration = 5000) {
        const notification = document.getElementById(`${type}-notification`);
        if (!notification) return;

        const messageEl = notification.querySelector('.notification-message');
        if (messageEl) messageEl.textContent = message;

        notification.classList.remove('hidden');
        notification.style.animation = 'slideIn 0.3s ease-out';

        // è‡ªå‹•é—œé–‰é€šçŸ¥
        if (duration > 0) {
            setTimeout(() => {
                this.hideNotification(notification);
            }, duration);
        }
    }

    // éš±è—é€šçŸ¥
    hideNotification(notification) {
        if (!notification) return;
        
        notification.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => {
            notification.classList.add('hidden');
            notification.style.animation = '';
        }, 300);
    }

    // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
    showConfirmDialog(options = {}) {
        return new Promise((resolve) => {
            if (!this.confirmDialog) return resolve(false);

            const {
                title = 'ç¢ºèªæ“ä½œ',
                message = 'æ‚¨ç¢ºå®šè¦åŸ·è¡Œæ­¤æ“ä½œå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚',
                confirmText = 'ç¢ºèª',
                cancelText = 'å–æ¶ˆ',
                confirmButtonClass = 'bg-red-600 hover:bg-red-700',
                cancelButtonClass = 'bg-white hover:bg-gray-50'
            } = options;

            this.confirmTitle.textContent = title;
            this.confirmMessage.textContent = message;
            this.confirmOkBtn.textContent = confirmText;
            this.confirmCancelBtn.textContent = cancelText;

            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            this.confirmOkBtn.className = `ml-3 inline-flex justify-center px-4 py-2 text-sm font-medium text-white border border-transparent rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${confirmButtonClass}`;
            this.confirmCancelBtn.className = `px-4 py-2 text-sm font-medium text-gray-700 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${cancelButtonClass}`;

            this.confirmDialog.classList.remove('hidden');

            // è¨­ç½®ä¸€æ¬¡æ€§äº‹ä»¶ç›£è½å™¨
            const handleConfirm = () => {
                cleanup();
                resolve(true);
            };

            const handleCancel = () => {
                cleanup();
                resolve(false);
            };

            const cleanup = () => {
                this.confirmDialog.classList.add('hidden');
                this.confirmOkBtn.removeEventListener('click', handleConfirm);
                this.confirmCancelBtn.removeEventListener('click', handleCancel);
            };

            this.confirmOkBtn.addEventListener('click', handleConfirm);
            this.confirmCancelBtn.addEventListener('click', handleCancel);
        });
    }

    // éš±è—ç¢ºèªå°è©±æ¡†
    hideConfirmDialog() {
        if (this.confirmDialog) {
            this.confirmDialog.classList.add('hidden');
        }
    }

    // ç¦ç”¨è¡¨å–®æŒ‰éˆ•
    disableButtons(form, disabled = true) {
        const buttons = form.querySelectorAll('button, [type="submit"], [type="button"]');
        buttons.forEach(button => {
            if (disabled) {
                button.setAttribute('disabled', 'disabled');
            } else {
                button.removeAttribute('disabled');
            }
        });
    }

    // æ ¼å¼åŒ–æ—¥æœŸ
    formatDate(date, format = 'YYYY-MM-DD') {
        if (!date) return '';
        
        const d = new Date(date);
        if (isNaN(d.getTime())) return '';

        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        const hours = String(d.getHours()).padStart(2, '0');
        const minutes = String(d.getMinutes()).padStart(2, '0');
        const seconds = String(d.getSeconds()).padStart(2, '0');

        return format
            .replace('YYYY', year)
            .replace('MM', month)
            .replace('DD', day)
            .replace('HH', hours)
            .replace('mm', minutes)
            .replace('ss', seconds);
    }

    // æ ¼å¼åŒ–è²¨å¹£
    formatCurrency(amount, currency = 'TWD') {
        if (amount === null || amount === undefined) return '';
        return new Intl.NumberFormat('zh-TW', {
            style: 'currency',
            currency: currency,
            minimumFractionDigits: 0
        }).format(amount);
    }
}

// åˆå§‹åŒ– UI å¯¦ä¾‹
window.ui = new UI();
// å°å‡º UI å¯¦ä¾‹
if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {
    module.exports = ui;
} else {
    window.UI = ui;
}



===== templates\base.html =====
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - æ›¸æˆ¿è¨˜å¸³èˆ‡ç‡Ÿé‹ç®¡ç†ç³»çµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/styles.css" rel="stylesheet">
</head>
<body class="bg-gray-100">
    <!-- å°èˆªæ¬„ -->
    <nav class="bg-blue-600 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-xl font-bold">ğŸ“š æ›¸æˆ¿ç®¡ç†ç³»çµ±</a>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <a href="/" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                        <i class="fas fa-tachometer-alt mr-1"></i> å„€è¡¨æ¿
                    </a>
                    <a href="/products" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                        <i class="fas fa-box mr-1"></i> å•†å“ç®¡ç†
                    </a>
                    <a href="/purchases" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                        <i class="fas fa-shopping-cart mr-1"></i> é€²è²¨ç®¡ç†
                    </a>
                    <a href="/sales" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                        <i class="fas fa-cash-register mr-1"></i> éŠ·å”®ç®¡ç†
                    </a>
                    <a href="/members" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                        <i class="fas fa-users mr-1"></i> æœƒå“¡ç®¡ç†
                    </a>
                    <a href="/suppliers" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                        <i class="fas fa-truck mr-1"></i> ä¾›æ‡‰å•†ç®¡ç†
                    </a>
                    <a href="/reports" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">
                        <i class="fas fa-chart-bar mr-1"></i> å ±è¡¨åˆ†æ
                    </a>
                </div>
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-button" class="text-white focus:outline-none">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- ç§»å‹•ç«¯èœå–® -->
        <div id="mobile-menu" class="md:hidden hidden pb-4 px-4">
            <a href="/" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">
                <i class="fas fa-tachometer-alt mr-2"></i> å„€è¡¨æ¿
            </a>
            <a href="/products" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">
                <i class="fas fa-box mr-2"></i> å•†å“ç®¡ç†
            </a>
            <a href="/purchases" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">
                <i class="fas fa-shopping-cart mr-2"></i> é€²è²¨ç®¡ç†
            </a>
            <a href="/sales" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">
                <i class="fas fa-cash-register mr-2"></i> éŠ·å”®ç®¡ç†
            </a>
            <a href="/members" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">
                <i class="fas fa-users mr-2"></i> æœƒå“¡ç®¡ç†
            </a>
            <a href="/suppliers" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">
                <i class="fas fa-truck mr-2"></i> ä¾›æ‡‰å•†ç®¡ç†
            </a>
            <a href="/reports" class="block px-3 py-2 rounded-md text-base font-medium hover:bg-blue-700">
                <i class="fas fa-chart-bar mr-2"></i> å ±è¡¨åˆ†æ
            </a>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹ -->
    <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        {% block content %}{% endblock %}
    </main>

    <!-- é è…³ -->
    <footer class="bg-white mt-12">
        <div class="max-w-7xl mx-auto py-6 px-4 overflow-hidden sm:px-6 lg:px-8">
            <p class="text-center text-gray-500 text-sm">
                &copy; 2025 æ›¸æˆ¿è¨˜å¸³èˆ‡ç‡Ÿé‹ç®¡ç†ç³»çµ±. All rights reserved.
            </p>
        </div>
    </footer>

    <!-- å…¨å±€çµ„ä»¶ -->
    {% include 'components/loading.html' %}
    {% include 'components/notifications.html' %}
    {% include 'components/confirm_dialog.html' %}

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/static/js/ui.js"></script>      
    <script src="/static/js/main.js"></script>    {% block scripts %}{% endblock %}
</body>
</html>


===== templates\index.html =====
{% extends "base.html" %}

{% block content %}
<div class="bg-white shadow rounded-lg p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">å„€è¡¨æ¿</h1>
    
    <!-- çµ±è¨ˆå¡ç‰‡ -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- ä»Šæ—¥éŠ·å”®é¡ -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                    <i class="fas fa-dollar-sign text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-gray-500 text-sm">ä»Šæ—¥éŠ·å”®é¡</p>
                    <p class="text-2xl font-semibold text-gray-800">$12,345</p>
                </div>
            </div>
        </div>
        
        <!-- ä»Šæ—¥è¨‚å–®æ•¸ -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-green-500">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-green-100 text-green-600">
                    <i class="fas fa-shopping-cart text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-gray-500 text-sm">ä»Šæ—¥è¨‚å–®æ•¸</p>
                    <p class="text-2xl font-semibold text-gray-800">24</p>
                </div>
            </div>
        </div>
        
        <!-- å¹³å‡è¨‚å–®é‡‘é¡ -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-yellow-500">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                    <i class="fas fa-receipt text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-gray-500 text-sm">å¹³å‡è¨‚å–®é‡‘é¡</p>
                    <p class="text-2xl font-semibold text-gray-800">$514</p>
                </div>
            </div>
        </div>
        
        <!-- ä½åº«å­˜å•†å“ -->
        <div class="bg-white rounded-lg shadow p-6 border-l-4 border-red-500">
            <div class="flex items-center">
                <div class="p-3 rounded-full bg-red-100 text-red-600">
                    <i class="fas fa-exclamation-triangle text-xl"></i>
                </div>
                <div class="ml-4">
                    <p class="text-gray-500 text-sm">ä½åº«å­˜å•†å“</p>
                    <p class="text-2xl font-semibold text-gray-800">8</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- éŠ·å”®è¶¨å‹¢åœ– -->
    <div class="bg-white rounded-lg shadow p-6 mb-8">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg font-semibold text-gray-800">éŠ·å”®è¶¨å‹¢</h2>
            <div class="flex space-x-2">
                <button class="px-3 py-1 text-sm rounded bg-blue-100 text-blue-600">æœ¬é€±</button>
                <button class="px-3 py-1 text-sm rounded hover:bg-gray-100">æœ¬æœˆ</button>
                <button class="px-3 py-1 text-sm rounded hover:bg-gray-100">æœ¬å¹´</button>
            </div>
        </div>
        <div class="h-64">
            <canvas id="salesChart"></canvas>
        </div>
    </div>
    
    <!-- æœ€è¿‘äº¤æ˜“ -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-semibold text-gray-800">æœ€è¿‘äº¤æ˜“</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è¨‚å–®ç·¨è™Ÿ</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å®¢æˆ¶</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ—¥æœŸ</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é‡‘é¡</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‹€æ…‹</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-blue-600">#ORD-2023-0001</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">ç‹å°æ˜</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2023-05-15 14:30</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$1,250</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">å·²å®Œæˆ</span>
                        </td>
                    </tr>
                    <!-- æ›´å¤šäº¤æ˜“è¨˜éŒ„... -->
                </tbody>
            </table>
        </div>
        <div class="bg-gray-50 px-6 py-3 flex items-center justify-between border-t border-gray-200">
            <div class="text-sm text-gray-500">
                é¡¯ç¤º <span class="font-medium">1</span> åˆ° <span class="font-medium">5</span> ç­†ï¼Œå…± <span class="font-medium">24</span> ç­†çµæœ
            </div>
            <div class="flex-1 flex justify-end">
                <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    ä¸‹ä¸€é 
                </a>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
// éŠ·å”®è¶¨å‹¢åœ–è¡¨
const salesCtx = document.getElementById('salesChart').getContext('2d');
const salesChart = new Chart(salesCtx, {
    type: 'line',
    data: {
        labels: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ', '6æœˆ'],
        datasets: [{
            label: 'éŠ·å”®é¡',
            data: [12000, 19000, 15000, 25000, 22000, 30000],
            borderColor: 'rgb(59, 130, 246)',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.3,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    drawBorder: false
                },
                ticks: {
                    callback: function(value) {
                        return '$' + value.toLocaleString();
                    }
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        },
        plugins: {
            legend: {
                display: false
            }
        }
    }
});
</script>
{% endblock %}

{% endblock %}


===== templates\members.html =====
{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- é é¢æ¨™é¡Œå’Œæ“ä½œæŒ‰éˆ• -->
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">æœƒå“¡ç®¡ç†</h1>
        <button id="new-member-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center">
            <i class="fas fa-plus mr-2"></i> æ–°å¢æœƒå“¡
        </button>
    </div>

    <!-- æœå°‹å’Œç¯©é¸ -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="md:col-span-2">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input type="text" id="search-members" class="pl-10 w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="æœå°‹æœƒå“¡å§“åã€é›»è©±æˆ–é›»å­éƒµä»¶...">
                </div>
            </div>
            <div class="flex space-x-2">
                <select id="member-status-filter" class="w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                    <option value="active">å•Ÿç”¨ä¸­</option>
                    <option value="inactive">å·²åœç”¨</option>
                </select>
                <button id="filter-btn" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md">
                    <i class="fas fa-filter"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- æœƒå“¡åˆ—è¡¨ -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æœƒå“¡ç·¨è™Ÿ</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å§“å</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é›»è©±</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é›»å­éƒµä»¶</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç´¯è¨ˆæ¶ˆè²»</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æœƒå“¡ç­‰ç´š</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‹€æ…‹</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="members-list" class="bg-white divide-y divide-gray-200">
                    <!-- æœƒå“¡åˆ—è¡¨å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                    <tr>
                        <td colspan="8" class="px-6 py-4 text-center text-gray-500">è¼‰å…¥ä¸­...</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- åˆ†é æ§åˆ¶ -->
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
            <div class="flex-1 flex justify-between sm:hidden">
                <button id="mobile-prev-page" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    ä¸Šä¸€é 
                </button>
                <button id="mobile-next-page" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    ä¸‹ä¸€é 
                </button>
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        é¡¯ç¤º <span id="start-item" class="font-medium">0</span> åˆ° <span id="end-item" class="font-medium">0</span> ç­†ï¼Œå…± <span id="total-items" class="font-medium">0</span> ç­†
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        <button id="prev-page" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">ä¸Šä¸€é </span>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div id="pagination-numbers" class="flex">
                            <!-- åˆ†é æ•¸å­—å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                        </div>
                        <button id="next-page" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">ä¸‹ä¸€é </span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æ–°å¢/ç·¨è¼¯æœƒå“¡ Modal -->
<div id="member-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
    <div class="relative top-20 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white">
        <div class="flex justify-between items-center pb-3">
            <h3 id="member-modal-title" class="text-xl font-semibold text-gray-800">æ–°å¢æœƒå“¡</h3>
            <button id="close-member-modal" class="text-gray-400 hover:text-gray-500">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        
        <div class="mt-4">
            <form id="member-form" class="space-y-4">
                <input type="hidden" id="member-id">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700">å§“å <span class="text-red-500">*</span></label>
                        <input type="text" id="name" name="name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700">é›»è©± <span class="text-red-500">*</span></label>
                        <input type="tel" id="phone" name="phone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">é›»å­éƒµä»¶</label>
                        <input type="email" id="email" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="birthday" class="block text-sm font-medium text-gray-700">ç”Ÿæ—¥</label>
                        <input type="date" id="birthday" name="birthday" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="member-level" class="block text-sm font-medium text-gray-700">æœƒå“¡ç­‰ç´š</label>
                        <select id="member-level" name="member_level" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="standard">æ¨™æº–æœƒå“¡</option>
                            <option value="silver">éŠ€å¡æœƒå“¡</option>
                            <option value="gold">é‡‘å¡æœƒå“¡</option>
                            <option value="platinum">ç™½é‡‘æœƒå“¡</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="status" class="block text-sm font-medium text-gray-700">ç‹€æ…‹</label>
                        <select id="status" name="status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                            <option value="active">å•Ÿç”¨</option>
                            <option value="inactive">åœç”¨</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label for="address" class="block text-sm font-medium text-gray-700">åœ°å€</label>
                    <input type="text" id="address" name="address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                
                <div>
                    <label for="notes" class="block text-sm font-medium text-gray-700">å‚™è¨»</label>
                    <textarea id="notes" name="notes" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></textarea>
                </div>
                
                <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                    <button type="submit" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                        å„²å­˜
                    </button>
                    <button type="button" id="cancel-member-form" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">
                        å–æ¶ˆ
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- è¼‰å…¥ JavaScript -->
<script src="/static/js/members.js" type="module"></script>
{% endblock %}


===== templates\products.html =====
{% extends "base.html" %}

{% block content %}
<div class="bg-white shadow rounded-lg p-6">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">å•†å“ç®¡ç†</h1>
            <button id="addProductBtn" class="hidden bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
                <i class="fas fa-plus mr-2"></i> æ–°å¢å•†å“
            </button>
    </div>
    
    <!-- æœå°‹èˆ‡ç¯©é¸ -->
    <div class="mb-6 bg-gray-50 p-4 rounded-lg">
        <div class="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-4 md:space-y-0">
            <div class="flex-1">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input type="text" id="searchInput" class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="æœå°‹å•†å“...">
                </div>
            </div>
            <div class="flex space-x-2">
                <select id="categoryFilter" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="">æ‰€æœ‰é¡åˆ¥</option>
                    <option>æ›¸ç±</option>
                    <option>æ–‡å…·</option>
                    <option>ç¦®å“</option>
                </select>
                <select id="statusFilter" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="">æ‰€æœ‰ç‹€æ…‹</option>
                    <option value="in_stock">æœ‰åº«å­˜</option>
                    <option value="low_stock">ä½åº«å­˜</option>
                    <option value="out_of_stock">ç„¡åº«å­˜</option>
                </select>
                <select id="supplierFilter" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="">æ‰€æœ‰ä¾›æ‡‰å•†</option>
                </select>
                <select id="sortSelect" class="block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
                    <option value="">æ’åºæ–¹å¼</option>
                    <option value="name_asc">åç¨± Aâ†’Z</option>
                    <option value="name_desc">åç¨± Zâ†’A</option>
                    <option value="sale_price_asc">å”®åƒ¹ä½åˆ°é«˜</option>
                    <option value="sale_price_desc">å”®åƒ¹é«˜åˆ°ä½</option>
                    <option value="stock_asc">åº«å­˜å°‘åˆ°å¤š</option>
                    <option value="stock_desc">åº«å­˜å¤šåˆ°å°‘</option>
                </select>
            </div>
        </div>
    </div>
    
    <!-- å•†å“è¡¨æ ¼ -->
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å•†å“åç¨±</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é¡åˆ¥</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä¾›æ‡‰å•†</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æˆæœ¬åƒ¹</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å”®åƒ¹</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">åº«å­˜</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‹€æ…‹</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="productsTableBody" class="bg-white divide-y divide-gray-200">
                <!-- å•†å“æ•¸æ“šå°‡é€šé JavaScript å‹•æ…‹åŠ è¼‰ -->
                <tr>
                    <td colspan="8" class="px-6 py-4 text-center text-gray-500">
                        è¼‰å…¥ä¸­...
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- åˆ†é  -->
    <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
            <div>
                <p class="text-sm text-gray-700">
                    é¡¯ç¤º <span class="font-medium" id="startItem">1</span> åˆ° 
                    <span class="font-medium" id="endItem">10</span> ç­†ï¼Œå…± 
                    <span class="font-medium" id="totalItems">0</span> ç­†çµæœ
                </p>
            </div>
            <div>
                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                    <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <span class="sr-only">ä¸Šä¸€é </span>
                        <i class="fas fa-chevron-left"></i>
                    </a>
                    <a href="#" aria-current="page" class="z-10 bg-blue-50 border-blue-500 text-blue-600 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                        1
                    </a>
                    <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 relative inline-flex items-center px-4 py-2 border text-sm font-medium">
                        2
                    </a>
                    <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 hidden md:inline-flex relative items-center px-4 py-2 border text-sm font-medium">
                        3
                    </a>
                    <span class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700">
                        ...
                    </span>
                    <a href="#" class="bg-white border-gray-300 text-gray-500 hover:bg-gray-50 hidden md:inline-flex relative items-center px-4 py-2 border text-sm font-medium">
                        8
                    </a>
                    <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                        <span class="sr-only">ä¸‹ä¸€é </span>
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- æ–°å¢/ç·¨è¼¯å•†å“æ¨¡æ…‹æ¡† -->
<div id="productModal" class="fixed z-10 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-2xl sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="modalTitle">æ–°å¢å•†å“</h3>
                        <div class="mt-5">
                            <form id="productForm">
                                <input type="hidden" id="productId">
                                <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                                    <div class="sm:col-span-4">
                                        <label for="productName" class="block text-sm font-medium text-gray-700">å•†å“åç¨±</label>
                                        <div class="mt-1">
                                            <input type="text" name="productName" id="productName" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md" required>
                                        </div>
                                    </div>
                                    <div class="sm:col-span-3">
                                        <label for="category" class="block text-sm font-medium text-gray-700">é¡åˆ¥</label>
                                        <div class="mt-1">
                                            <select id="category" name="category" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md">
                                                <option value="">é¸æ“‡é¡åˆ¥</option>
                                                <option>æ›¸ç±</option>
                                                <option>æ–‡å…·</option>
                                                <option>ç¦®å“</option>
                                                <option>å…¶ä»–</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="sm:col-span-3">
                                        <label for="supplier" class="block text-sm font-medium text-gray-700">ä¾›æ‡‰å•†</label>
                                        <div class="mt-1">
                                            <select id="supplier" name="supplier" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md">
                                                <option value="">é¸æ“‡ä¾›æ‡‰å•†</option>
                                                <!-- ä¾›æ‡‰å•†é¸é …å°‡å‹•æ…‹åŠ è¼‰ -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label for="costPrice" class="block text-sm font-medium text-gray-700">æˆæœ¬åƒ¹</label>
                                        <div class="mt-1 relative rounded-md shadow-sm">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 sm:text-sm">$</span>
                                            </div>
                                            <input type="number" step="0.01" name="costPrice" id="costPrice" class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="0.00">
                                        </div>
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label for="salePrice" class="block text-sm font-medium text-gray-700">å”®åƒ¹</label>
                                        <div class="mt-1 relative rounded-md shadow-sm">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                <span class="text-gray-500 sm:text-sm">$</span>
                                            </div>
                                            <input type="number" step="0.01" name="salePrice" id="salePrice" class="focus:ring-blue-500 focus:border-blue-500 block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md" placeholder="0.00" required>
                                        </div>
                                    </div>
                                    <div class="sm:col-span-2">
                                        <label for="stock" class="block text-sm font-medium text-gray-700">åº«å­˜æ•¸é‡</label>
                                        <div class="mt-1">
                                            <input type="number" name="stock" id="stock" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md" value="0">
                                        </div>
                                    </div>
                                    <div class="sm:col-span-3">
                                        <label for="minStock" class="block text-sm font-medium text-gray-700">æœ€ä½åº«å­˜è­¦å‘Š</label>
                                        <div class="mt-1">
                                            <input type="number" name="minStock" id="minStock" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md" value="5">
                                        </div>
                                    </div>
                                    <div class="sm:col-span-3">
                                        <label for="unit" class="block text-sm font-medium text-gray-700">å–®ä½</label>
                                        <div class="mt-1">
                                            <input type="text" name="unit" id="unit" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md" placeholder="å€‹/æœ¬/æ”¯">
                                        </div>
                                    </div>
                                    <div class="sm:col-span-6">
                                        <label for="description" class="block text-sm font-medium text-gray-700">å•†å“æè¿°</label>
                                        <div class="mt-1">
                                            <textarea id="description" name="description" rows="3" class="shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" id="saveProductBtn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">å„²å­˜</button>
                <button type="button" id="cancelProductBtn" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script src="/static/js/products.js"></script>
{% endblock %}

{% endblock %}


===== templates\purchases.html =====
{% extends "base.html" %}

{% block title %}é€²è²¨ç®¡ç† - æ›¸æˆ¿è¨˜å¸³ç³»çµ±{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <!-- é é¢æ¨™é¡Œèˆ‡æ“ä½œæŒ‰éˆ• -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-4 md:mb-0">é€²è²¨ç®¡ç†</h1>
        <div class="flex space-x-2">
            <button id="new-purchase-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                <i class="fas fa-plus mr-1"></i> æ–°å¢é€²è²¨
            </button>
            <button id="export-purchases-btn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium transition-colors">
                <i class="fas fa-file-export mr-1"></i> åŒ¯å‡ºå ±è¡¨
            </button>
        </div>
    </div>

    <!-- æœå°‹èˆ‡ç¯©é¸å€åŸŸ -->
    <div class="bg-white rounded-lg shadow p-4 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="md:col-span-2">
                <label for="search" class="block text-sm font-medium text-gray-700 mb-1">æœå°‹</label>
                <div class="relative">
                    <input type="text" id="search" placeholder="æœå°‹å•†å“åç¨±ã€ä¾›æ‡‰å•†ã€å–®è™Ÿ..." 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                </div>
            </div>
            <div>
                <label for="supplier-filter" class="block text-sm font-medium text-gray-700 mb-1">ä¾›æ‡‰å•†</label>
                <select id="supplier-filter" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                    <option value="">å…¨éƒ¨ä¾›æ‡‰å•†</option>
                    <!-- å‹•æ…‹è¼‰å…¥ä¾›æ‡‰å•†é¸é … -->
                </select>
            </div>
            <div>
                <label for="date-range" class="block text-sm font-medium text-gray-700 mb-1">æ—¥æœŸç¯„åœ</label>
                <div class="relative">
                    <input type="text" id="date-range" placeholder="é¸æ“‡æ—¥æœŸç¯„åœ" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 cursor-pointer">
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                        <i class="far fa-calendar-alt text-gray-400"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é€²è²¨æ¸…å–® -->
    <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é€²è²¨å–®è™Ÿ</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä¾›æ‡‰å•†</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å•†å“æ•¸é‡</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç¸½é‡‘é¡</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">é€²è²¨æ—¥æœŸ</th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ç‹€æ…‹</th>
                        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="purchases-list" class="bg-white divide-y divide-gray-200">
                    <!-- å‹•æ…‹è¼‰å…¥é€²è²¨è¨˜éŒ„ -->
                    <tr>
                        <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">è¼‰å…¥ä¸­...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- åˆ†é æ§åˆ¶ -->
        <div class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
            <div class="flex-1 flex justify-between sm:hidden">
                <button id="mobile-prev-page" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">ä¸Šä¸€é </button>
                <button id="mobile-next-page" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">ä¸‹ä¸€é </button>
            </div>
            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                <div>
                    <p class="text-sm text-gray-700">
                        é¡¯ç¤º <span id="start-item" class="font-medium">0</span> åˆ° <span id="end-item" class="font-medium">0</span> ç­†ï¼Œå…± <span id="total-items" class="font-medium">0</span> ç­†
                    </p>
                </div>
                <div>
                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                        <button id="prev-page" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">ä¸Šä¸€é </span>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div id="pagination-numbers" class="flex">
                            <!-- åˆ†é æ•¸å­—æŒ‰éˆ•å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                        </div>
                        <button id="next-page" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                            <span class="sr-only">ä¸‹ä¸€é </span>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- é€²è²¨æ˜ç´° Modal -->
<div id="purchase-detail-modal" class="fixed inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" aria-hidden="true"></div>
        <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full">
            <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">é€²è²¨æ˜ç´°</h3>
                            <button type="button" class="close-modal-btn text-gray-400 hover:text-gray-500">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="mt-2">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <p class="text-sm text-gray-500">é€²è²¨å–®è™Ÿ</p>
                                    <p id="purchase-id" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">ä¾›æ‡‰å•†</p>
                                    <p id="supplier-name" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">é€²è²¨æ—¥æœŸ</p>
                                    <p id="purchase-date" class="font-medium">-</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500">ç‹€æ…‹</p>
                                    <p id="purchase-status" class="font-medium">-</p>
                                </div>
                                <div class="md:col-span-2">
                                    <p class="text-sm text-gray-500">å‚™è¨»</p>
                                    <p id="purchase-notes" class="font-medium">-</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <h4 class="text-md font-medium text-gray-900 mb-2">å•†å“æ˜ç´°</h4>
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å•†å“ç·¨è™Ÿ</th>
                                                <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å•†å“åç¨±</th>
                                                <th scope="col" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">å–®åƒ¹</th>
                                                <th scope="col" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">æ•¸é‡</th>
                                                <th scope="col" class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">å°è¨ˆ</th>
                                            </tr>
                                        </thead>
                                        <tbody id="purchase-items" class="bg-white divide-y divide-gray-200">
                                            <!-- å‹•æ…‹è¼‰å…¥é€²è²¨å•†å“æ˜ç´° -->
                                        </tbody>
                                        <tfoot>
                                            <tr class="border-t border-gray-200">
                                                <td colspan="4" class="px-3 py-2 text-right text-sm font-medium text-gray-700">å•†å“ç¸½è¨ˆ</td>
                                                <td id="purchase-subtotal" class="px-3 py-2 text-right text-sm font-medium">$0</td>
                                            </tr>
                                            <tr>
                                                <td colspan="4" class="px-3 py-2 text-right text-sm font-medium text-gray-700">é‹è²»</td>
                                                <td id="purchase-shipping" class="px-3 py-2 text-right text-sm font-medium">$0</td>
                                            </tr>
                                            <tr class="border-t border-gray-200">
                                                <td colspan="4" class="px-3 py-2 text-right text-sm font-bold text-gray-900">ç¸½è¨ˆ</td>
                                                <td id="purchase-total" class="px-3 py-2 text-right text-sm font-bold text-gray-900">$0</td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
                <button type="button" class="close-modal-btn w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm">
                    é—œé–‰
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/purchases.js"></script>
{% endblock %}
